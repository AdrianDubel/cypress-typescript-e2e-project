name: Cypress Tests
on: [push]
jobs:
 Cypress-Test:
   runs-on: ubuntu-latest
   
   steps:
     - name: Checkout GitCode
       uses: actions/checkout@v2
 
     - name: Install dependencies
       run: npm install

     - name: Start Local Server
       run: |
         npx http-server -p 9000 &
         sleep 2 # Poczekaj chwilÄ™ na uruchomienie serwera

     - name: Run Cypress Test
       uses: cypress-io/github-action@v4
       with:
        command: npx cypress run --browser chrome 
        continue-on-error: true
       env:
         CYPRESS_USERNAME: ${{ secrets.CYPRESS_USERNAME }}
         CYPRESS_PASSWORD: ${{ secrets.CYPRESS_PASSWORD }}

      - name: Send Test Report Email
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 587
          username: ${{ secrets.EMAIL_USERNAME }}
          password: ${{ secrets.EMAIL_PASSWORD }}
          subject: "Cypress Test Report"
          to: wuper.dev88@gmail.com
          from: adrian.dubel88@gmail.com
          body: "Attached is the Cypress test report."
          attachments: cypress/reports/html/index.html   